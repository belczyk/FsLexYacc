<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Building JSON parser using FsLex and FsYacc
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A short summary of your project">
    <meta name="author" content="Your Name">

    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="content/style.css" />
    <script type="text/javascript" src="content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/fsprojects/FsLexYacc">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/FsLexYacc/index.html">FsLexYacc</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>Building JSON parser using FsLex and FsYacc</h1>

<p>Content:</p>

<ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#syntaxtree">Syntax tree</a></li>
<li><a href="#parser">Parser</a></li>
<li><a href="#lexer">Lexer</a></li>
<li><a href="#program">Program</a></li>
</ol>

<h2>1 Introduction</h2>

<p>FsLexYacc is a solution which allows you to define and generate lexer and parser. It's made of two parts FsLex (lexer generator) and FsYacc (parser generator). Parsing is a two phase process. In the first phase lexer is analyzing text and creates a stream of tokens (or token list). In the second phase parser is going through tokens in the stream and generates output (syntax tree).</p>

<p>FsYacc (parser generator) is decoupled from FsLex (lexer generator) and can accept a token stream from any lexer. Generated parser will require a function which can translate tokens generated by lexer into tokens configured in parser. To avoid additional pointless work if you use FsYacc with FsLex define parser first. This way FsYacc will generate an union type defining all required tokens. Then you can use this union type to generate tokens inside lexer. So despite fact that lexing happens before parsing we will define parser first. It means that in your F# project generated parser must be first on the files list before lexer.</p>

<h2>2 Syntax tree</h2>

<p>Create a new F# library project and install FsLexYacc package:
    PM> Install-Package FsLexYacc
We will start by describing the syntax tree. It will be result of parsing a text. Add a new file called <code>JsonValue.fs</code> and paste below union type definition:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">JsonValue</span> <span class="o">=</span> 
  | <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Assoc</span> <span class="k">of</span> (<span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">string</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs1', 4)" onmouseover="showTip(event, 'fs1', 4)" class="i">JsonValue</span>) <span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="i">list</span>
  | <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">Bool</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="i">bool</span>
  | <span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="i">Float</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="i">float</span>
  | <span onmouseout="hideTip(event, 'fs9', 10)" onmouseover="showTip(event, 'fs9', 10)" class="i">Int</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs10', 11)" onmouseover="showTip(event, 'fs10', 11)" class="i">int</span>
  | <span onmouseout="hideTip(event, 'fs11', 12)" onmouseover="showTip(event, 'fs11', 12)" class="i">List</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 13)" onmouseover="showTip(event, 'fs1', 13)" class="i">JsonValue</span> <span onmouseout="hideTip(event, 'fs4', 14)" onmouseover="showTip(event, 'fs4', 14)" class="i">list</span>
  | <span onmouseout="hideTip(event, 'fs12', 15)" onmouseover="showTip(event, 'fs12', 15)" class="i">Null</span>
  | <span onmouseout="hideTip(event, 'fs13', 16)" onmouseover="showTip(event, 'fs13', 16)" class="i">String</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 17)" onmouseover="showTip(event, 'fs3', 17)" class="i">string</span></pre>
</td>
</tr>
</table>

<p>Nothing fancy here. Assoc is simply an object which contains a list of properties (pair where <code>fst</code> is a property name and <code>snd</code> is a value).
<code>List</code> is for JSON arrays. We also have numbers, bool, string and null. It's enough to describe a valid JSON.</p>

<h2>3 Parser definition</h2>

<p>In your project root directory (not solution root) create a file called <code>Parser.fsy</code>. Now edit project file (.fsproj ).  Find  the line where JsonValue.fs is included, than add this element this xml:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="o">&lt;</span><span class="i">FsYacc</span> <span class="i">Include</span><span class="o">=</span><span class="s">&quot;</span><span class="s">Parser</span><span class="s">.</span><span class="s">fsy</span><span class="s">&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">OtherFlags</span><span class="o">&gt;</span><span class="o">--</span><span class="k">module</span> <span class="i">Parser</span><span class="o">&lt;/</span><span class="i">OtherFlags</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="i">FsYacc</span><span class="o">&gt;</span></pre>
</td>
</tr>
</table>

<p>Outside ItemGroup element add this lines:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="o">&lt;</span><span class="i">Import</span> <span class="i">Project</span><span class="o">=</span><span class="s">&quot;</span><span class="s">$</span><span class="s">(</span><span class="s">FSharpTargetsPath</span><span class="s">)</span><span class="s">&quot;</span> <span class="i">Condition</span><span class="o">=</span><span class="s">&quot;</span><span class="s">Exists</span><span class="s">(</span><span class="s">&#39;</span><span class="s">$</span><span class="s">(</span><span class="s">FSharpTargetsPath</span><span class="s">)</span><span class="s">&#39;</span><span class="s">)</span><span class="s">&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="i">Import</span> <span class="i">Project</span><span class="o">=</span><span class="s">&quot;</span><span class="s">.</span><span class="s">.</span><span class="s">\</span><span class="s">.</span><span class="s">.</span><span class="s">\b</span><span class="s">in</span><span class="s">\</span><span class="s">Debug</span><span class="s">\</span><span class="s">FsLexYacc</span><span class="s">.</span><span class="s">targets</span><span class="s">&quot;</span> <span class="o">/&gt;</span></pre>
</td>
</tr>
</table>

<p>The whole thing should be like this:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="o">..</span><span class="o">.</span>
<span class="o">&lt;</span><span class="i">Import</span> <span class="i">Project</span><span class="o">=</span><span class="s">&quot;</span><span class="s">$</span><span class="s">(</span><span class="s">FSharpTargetsPath</span><span class="s">)</span><span class="s">&quot;</span> <span class="i">Condition</span><span class="o">=</span><span class="s">&quot;</span><span class="s">Exists</span><span class="s">(</span><span class="s">&#39;</span><span class="s">$</span><span class="s">(</span><span class="s">FSharpTargetsPath</span><span class="s">)</span><span class="s">&#39;</span><span class="s">)</span><span class="s">&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="i">Import</span> <span class="i">Project</span><span class="o">=</span><span class="s">&quot;</span><span class="s">.</span><span class="s">.</span><span class="s">\</span><span class="s">.</span><span class="s">.</span><span class="s">\b</span><span class="s">in</span><span class="s">\</span><span class="s">Debug</span><span class="s">\</span><span class="s">FsLexYacc</span><span class="s">.</span><span class="s">targets</span><span class="s">&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="i">ItemGroup</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">Compile</span> <span class="i">Include</span><span class="o">=</span><span class="s">&quot;</span><span class="s">JsonValue</span><span class="s">.</span><span class="s">fs</span><span class="s">&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">FsYacc</span> <span class="i">Include</span><span class="o">=</span><span class="s">&quot;</span><span class="s">Parser</span><span class="s">.</span><span class="s">fsy</span><span class="s">&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">OtherFlags</span><span class="o">&gt;</span><span class="o">--</span><span class="k">module</span> <span class="i">Parser</span><span class="o">&lt;/</span><span class="i">OtherFlags</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="i">FsYacc</span><span class="o">&gt;</span>
    <span class="o">..</span><span class="o">.</span>
<span class="o">&lt;</span><span class="i">ItemGroup</span><span class="o">&gt;</span>
<span class="o">..</span><span class="o">.</span></pre>
</td>
</tr>
</table>

<p>Reload/Open the project and add below code to Parser.fsy:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">//This parser has been writen with help of &quot;Real world OCaml&quot; book By Yaron Minsky, Anil Madhavapeddy, Jason Hickey (chapter 16)</span>
<span class="o">%</span>{
<span class="k">open</span> <span class="i">JsonParsing</span>
<span class="o">%</span>}

<span class="o">%</span><span class="i">start</span> <span class="i">start</span>

<span class="o">%</span><span class="i">token</span> <span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs10', 18)" onmouseover="showTip(event, 'fs10', 18)" class="i">int</span><span class="o">&gt;</span> <span class="i">INT</span>
<span class="o">%</span><span class="i">token</span> <span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs8', 19)" onmouseover="showTip(event, 'fs8', 19)" class="i">float</span><span class="o">&gt;</span> <span class="i">FLOAT</span>
<span class="o">%</span><span class="i">token</span> <span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs3', 20)" onmouseover="showTip(event, 'fs3', 20)" class="i">string</span><span class="o">&gt;</span> <span class="i">ID</span>
<span class="o">%</span><span class="i">token</span> <span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs3', 21)" onmouseover="showTip(event, 'fs3', 21)" class="i">string</span><span class="o">&gt;</span> <span class="i">STRING</span>
<span class="o">%</span><span class="i">token</span> <span class="i">TRUE</span>
<span class="o">%</span><span class="i">token</span> <span class="i">FALSE</span>
<span class="o">%</span><span class="i">token</span> <span class="i">NULL</span>
<span class="o">%</span><span class="i">token</span> <span class="i">LEFT_BRACE</span>
<span class="o">%</span><span class="i">token</span> <span class="i">RIGHT_BRACE</span>
<span class="o">%</span><span class="i">token</span> <span class="i">LEFT_BRACK</span>
<span class="o">%</span><span class="i">token</span> <span class="i">RIGHT_BRACK</span>
<span class="o">%</span><span class="i">token</span> <span class="i">COLON</span>
<span class="o">%</span><span class="i">token</span> <span class="i">COMMA</span>
<span class="o">%</span><span class="i">token</span> <span class="i">EOF</span>

<span class="o">%</span><span class="k">type</span> <span class="o">&lt;</span><span class="i">JsonParsing</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs1', 22)" onmouseover="showTip(event, 'fs1', 22)" class="i">JsonValue</span> <span onmouseout="hideTip(event, 'fs14', 23)" onmouseover="showTip(event, 'fs14', 23)" class="i">option</span><span class="o">&gt;</span> <span class="i">start</span>

<span class="o">%%</span>

<span class="i">start</span><span class="o">:</span> <span class="i">prog</span> { <span class="o">$</span><span class="n">1</span> }

<span class="i">prog</span><span class="o">:</span>
  | <span class="i">EOF</span> { <span onmouseout="hideTip(event, 'fs15', 24)" onmouseover="showTip(event, 'fs15', 24)" class="i">None</span> }
  | <span class="i">value</span> { <span onmouseout="hideTip(event, 'fs16', 25)" onmouseover="showTip(event, 'fs16', 25)" class="i">Some</span> <span class="o">$</span><span class="n">1</span> }

<span class="i">value</span><span class="o">:</span>
  | <span class="i">LEFT_BRACE</span> <span class="i">object_fields</span> <span class="i">RIGHT_BRACE</span> { <span onmouseout="hideTip(event, 'fs2', 26)" onmouseover="showTip(event, 'fs2', 26)" class="i">Assoc</span> <span class="o">$</span><span class="n">2</span> }
  | <span class="i">LEFT_BRACK</span> <span class="i">array_values</span> <span class="i">RIGHT_BRACK</span> { <span onmouseout="hideTip(event, 'fs11', 27)" onmouseover="showTip(event, 'fs11', 27)" class="i">List</span> <span class="o">$</span><span class="n">2</span> }
  | <span class="i">STRING</span> { <span onmouseout="hideTip(event, 'fs13', 28)" onmouseover="showTip(event, 'fs13', 28)" class="i">String</span> <span class="o">$</span><span class="n">1</span> }
  | <span class="i">INT</span> { <span onmouseout="hideTip(event, 'fs9', 29)" onmouseover="showTip(event, 'fs9', 29)" class="i">Int</span> <span class="o">$</span><span class="n">1</span> }
  | <span class="i">FLOAT</span> { <span onmouseout="hideTip(event, 'fs7', 30)" onmouseover="showTip(event, 'fs7', 30)" class="i">Float</span> <span class="o">$</span><span class="n">1</span> }
  | <span class="i">TRUE</span> { <span onmouseout="hideTip(event, 'fs5', 31)" onmouseover="showTip(event, 'fs5', 31)" class="i">Bool</span> <span class="k">true</span> }
  | <span class="i">FALSE</span> { <span onmouseout="hideTip(event, 'fs5', 32)" onmouseover="showTip(event, 'fs5', 32)" class="i">Bool</span> <span class="k">false</span> }
  | <span class="i">NULL</span> { <span onmouseout="hideTip(event, 'fs12', 33)" onmouseover="showTip(event, 'fs12', 33)" class="i">Null</span> }

<span class="i">object_fields</span><span class="o">:</span> <span class="i">rev_object_fields</span> { <span onmouseout="hideTip(event, 'fs11', 34)" onmouseover="showTip(event, 'fs11', 34)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 35)" onmouseover="showTip(event, 'fs17', 35)" class="i">rev</span> <span class="o">$</span><span class="n">1</span> };

<span class="i">rev_object_fields</span><span class="o">:</span>
  | { [] }
  | <span class="i">STRING</span> <span class="i">COLON</span> <span class="i">value</span> { [(<span class="o">$</span><span class="n">1</span>,<span class="o">$</span><span class="n">3</span>)] }
  | <span class="i">rev_object_fields</span> <span class="i">COMMA</span> <span class="i">STRING</span> <span class="i">COLON</span> <span class="i">value</span> { (<span class="o">$</span><span class="n">3</span>, <span class="o">$</span><span class="n">5</span>) <span class="o">::</span> <span class="o">$</span><span class="n">1</span> }

<span class="i">array_values</span><span class="o">:</span>
  | { [] }
  | <span class="i">rev_values</span> { <span onmouseout="hideTip(event, 'fs11', 36)" onmouseover="showTip(event, 'fs11', 36)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 37)" onmouseover="showTip(event, 'fs17', 37)" class="i">rev</span> <span class="o">$</span><span class="n">1</span> }

<span class="i">rev_values</span><span class="o">:</span>
  | <span class="i">value</span> { [<span class="o">$</span><span class="n">1</span>] }
  | <span class="i">rev_values</span> <span class="i">COMMA</span> <span class="i">value</span> { <span class="o">$</span><span class="n">3</span> <span class="o">::</span> <span class="o">$</span><span class="n">1</span> }</pre>
</td>
</tr>
</table>

<p>This file is describing parsing rules and tokens. When you build project, in the project root directory a new file will be created called <code>Parser.fs</code>. Include it in your project.</p>

<p>Lets look closer at parser definition (<code>Parser.fsy)</code>. At the very top of the file there is a section for <code>open</code> statements. You can open any namespace or module you want. We need only <code>JsonParsing</code> where we defined <code>JsonValux</code> structure. All open statements should be between<code>%{</code> and <code>%}.</code></p>

<p>Next in line 6 we state what is an entry rule for our parser. <code>start</code>will be the name of the rule which will be exposed by parsing module. It has to correspond to a name of rule (in our case line 27).</p>

<p>Lines 8-21 define list of tokens. INT, FLOAT, STRING carry a value with them.</p>

<p>Then in line 23 we define what will be the result of parsing. In our case it will be JSON syntax tree defined by means of <code>JsonValue</code>. The type is actually <code>JsonValue option</code>. For empty text/file parser will return <code>NONE</code>.</p>

<p>Everything that follows <code>%%</code> are parsing rules. Rules are made of list of productions. You can reference one rule from the other which will allow you to define nested parsers (we will use it for objects and lists).</p>

<p>Our entry point (line 27) simply calls <code>prog</code>rule and returns it's result. Everything between curly braces is an ordinary F# code.</p>

<p><code>prog</code>(line 22) has two productions. First says that if the first token is <code>EOF</code>then return <code>None.</code>The second  rule says execute <code>value</code>rules and return <code>Some</code>containing it's result. Productions are processed one after another from top to bottom.</p>

<p>On line 33 we define main rule which will parse JSON values. Each rule has a name and list of productions. Each production starts with tokens pattern  and contains a result block <code>{}</code> which says what should be returned if this pattern is matched. Result block contains ordinary F# code.</p>

<p>Rules can reference each other. Like at line 34 where the pattern says match a left brace, whatever will be matched by <code>object_fields rule</code> and a right brace. Now what is this <code>Assoc $2.</code>Assoc is JsonValue union type that we create and $2 corresponds to value matched at second position in pattern which in this case is a list of properties.</p>

<p>If you look at <code>object_fields</code>rule, you'll notice it actually calls <code>rev_object_fields</code> and reverses order of results.  <code>rev_object_fields</code> is trying to match list of properties but it will collect them in wrong order. First production says that if token stream is empty (there is nothing between brace) then return empty list. We match an empty stream by not providing any pattern. Second rule is more interesting. It says that if we encounter a string then a colon and anything that matches the <code>value</code> rule we should return one element list containing a pair. First element in pair is matched string and second is matched value. This production will be used for objects that have one element or for the last property on the list (there is no comma at the end). Third rule contains two references to other rules. First we match any list of values then a comma, a string, a colon and <code>value</code>. And the result is a list where head is matched property (tokens on position 3-5) and tail is made of other matched properties. This production is for all properties which are followed by comma. Rules for arrays are very similar (even simpler).</p>

<p>That's it we can now start building lexer. You should be able to compile the project and see generated parser in <code>Parser.fs</code>. It looks ugly but fortunately we will always deal only with grammar description.</p>

<h2>4 Lexer</h2>

<p>In your project root directory (not solution root) create a file called <code>Lexer.fsl</code>. Now edit the project file (.fsproj ).  Find the line where <code>JsonValue.fs</code> is included then add this elment:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="o">&lt;</span><span class="i">FsLex</span> <span class="i">Include</span><span class="o">=</span><span class="s">&quot;</span><span class="s">Lexer</span><span class="s">.</span><span class="s">fsl</span><span class="s">&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">OtherFlags</span><span class="o">&gt;</span><span class="o">--</span><span class="i">unicode</span><span class="o">&lt;/</span><span class="i">OtherFlags</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="i">FsLex</span><span class="o">&gt;</span></pre>
</td>
</tr>
</table>

<p>The whole thing should be like this:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="o">..</span><span class="o">.</span>
<span class="o">&lt;</span><span class="i">Import</span> <span class="i">Project</span><span class="o">=</span><span class="s">&quot;</span><span class="s">$</span><span class="s">(</span><span class="s">FSharpTargetsPath</span><span class="s">)</span><span class="s">&quot;</span> <span class="i">Condition</span><span class="o">=</span><span class="s">&quot;</span><span class="s">Exists</span><span class="s">(</span><span class="s">&#39;</span><span class="s">$</span><span class="s">(</span><span class="s">FSharpTargetsPath</span><span class="s">)</span><span class="s">&#39;</span><span class="s">)</span><span class="s">&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="i">Import</span> <span class="i">Project</span><span class="o">=</span><span class="s">&quot;</span><span class="s">.</span><span class="s">.</span><span class="s">\</span><span class="s">.</span><span class="s">.</span><span class="s">\b</span><span class="s">in</span><span class="s">\</span><span class="s">Debug</span><span class="s">\</span><span class="s">FsLexYacc</span><span class="s">.</span><span class="s">targets</span><span class="s">&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="i">ItemGroup</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">Compile</span> <span class="i">Include</span><span class="o">=</span><span class="s">&quot;</span><span class="s">JsonValue</span><span class="s">.</span><span class="s">fs</span><span class="s">&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="i">FsYacc</span> <span class="i">Include</span><span class="o">=</span><span class="s">&quot;</span><span class="s">Parser</span><span class="s">.</span><span class="s">fsy</span><span class="s">&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">OtherFlags</span><span class="o">&gt;</span><span class="o">--</span><span class="k">module</span> <span class="i">Parser</span><span class="o">&lt;/</span><span class="i">OtherFlags</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="i">FsYacc</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">FsLex</span> <span class="i">Include</span><span class="o">=</span><span class="s">&quot;</span><span class="s">Lexer</span><span class="s">.</span><span class="s">fsl</span><span class="s">&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">OtherFlags</span><span class="o">&gt;</span><span class="o">--</span><span class="i">unicode</span><span class="o">&lt;/</span><span class="i">OtherFlags</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="i">FsLex</span><span class="o">&gt;</span>
<span class="o">..</span><span class="o">.</span></pre>
</td>
</tr>
</table>

<p>Reload/Open project and add below code to <code>Lexer.fsl:</code></p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">//This lexer has been writen with help of &quot;Real world OCaml&quot; book By Yaron Minsky, Anil Madhavapeddy, Jason Hickey (chapter 16)</span>
{

<span class="k">module</span> <span class="i">Lexer</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs18', 38)" onmouseover="showTip(event, 'fs18', 38)" class="i">Microsoft</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 39)" onmouseover="showTip(event, 'fs19', 39)" class="i">FSharp</span><span class="o">.</span><span class="i">Text</span><span class="o">.</span><span class="i">Lexing</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs20', 40)" onmouseover="showTip(event, 'fs20', 40)" class="i">System</span>
<span class="k">open</span> <span class="i">Parser</span>

<span class="k">exception</span> <span class="i">SyntaxError</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 41)" onmouseover="showTip(event, 'fs3', 41)" class="i">string</span>

<span class="k">let</span> <span class="i">lexeme</span> <span class="o">=</span> <span class="i">LexBuffer</span><span class="o">.</span><span class="i">LexemeString</span>

<span class="k">let</span> <span class="i">newline</span> (<span class="i">lexbuf</span><span class="o">:</span> <span class="i">LexBuffer</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span> 
  <span class="i">lexbuf</span><span class="o">.</span><span class="i">StartPos</span> <span class="o">&lt;-</span> <span class="i">lexbuf</span><span class="o">.</span><span class="i">StartPos</span><span class="o">.</span><span class="i">NextLine</span>
}

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 42)" onmouseover="showTip(event, 'fs10', 42)" class="i">int</span> <span class="o">=</span> [<span class="s">&#39;-&#39;</span> <span class="s">&#39;+&#39;</span>]<span class="o">?</span> [<span class="s">&#39;0&#39;</span><span class="o">-</span><span class="s">&#39;9&#39;</span>]<span class="o">+</span>
<span class="k">let</span> <span class="i">digit</span> <span class="o">=</span> [<span class="s">&#39;0&#39;</span><span class="o">-</span><span class="s">&#39;9&#39;</span>]
<span class="k">let</span> <span class="i">frac</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span> <span class="i">digit</span><span class="o">*</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 43)" onmouseover="showTip(event, 'fs21', 43)" class="i">exp</span> <span class="o">=</span> [<span class="s">&#39;e&#39;</span> <span class="s">&#39;E&#39;</span>] [<span class="s">&#39;-&#39;</span> <span class="s">&#39;+&#39;</span>]<span class="o">?</span> <span class="i">digit</span><span class="o">+</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 44)" onmouseover="showTip(event, 'fs8', 44)" class="i">float</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span><span class="o">?</span> <span class="i">digit</span><span class="o">*</span> <span class="i">frac</span><span class="o">?</span> <span onmouseout="hideTip(event, 'fs21', 45)" onmouseover="showTip(event, 'fs21', 45)" class="i">exp</span><span class="o">?</span>

<span class="k">let</span> <span class="i">white</span> <span class="o">=</span> [<span class="s">&#39; &#39;</span> <span class="s">&#39;\t&#39;</span>]<span class="o">+</span>
<span class="k">let</span> <span class="i">newline</span> <span class="o">=</span> <span class="s">&#39;\r&#39;</span> | <span class="s">&#39;\n&#39;</span> | <span class="s">&quot;</span><span class="s">\r</span><span class="s">\n</span><span class="s">&quot;</span>

<span class="i">rule</span> <span class="i">read</span> <span class="o">=</span>
  <span class="i">parse</span>
  | <span class="i">white</span>    { <span class="i">read</span> <span class="i">lexbuf</span> }
  | <span class="i">newline</span>  { <span class="i">newline</span> <span class="i">lexbuf</span>; <span class="i">read</span> <span class="i">lexbuf</span> }
  | <span onmouseout="hideTip(event, 'fs10', 46)" onmouseover="showTip(event, 'fs10', 46)" class="i">int</span>      { <span class="i">INT</span> (<span onmouseout="hideTip(event, 'fs10', 47)" onmouseover="showTip(event, 'fs10', 47)" class="i">int</span> (<span class="i">lexeme</span> <span class="i">lexbuf</span>)) }
  | <span onmouseout="hideTip(event, 'fs8', 48)" onmouseover="showTip(event, 'fs8', 48)" class="i">float</span>    { <span class="i">FLOAT</span> (<span onmouseout="hideTip(event, 'fs8', 49)" onmouseover="showTip(event, 'fs8', 49)" class="i">float</span> (<span class="i">lexeme</span> <span class="i">lexbuf</span>)) }
  | <span class="s">&quot;</span><span class="s">true</span><span class="s">&quot;</span>   { <span class="i">TRUE</span> }
  | <span class="s">&quot;</span><span class="s">false</span><span class="s">&quot;</span>  { <span class="i">FALSE</span> }
  | <span class="s">&quot;</span><span class="s">null</span><span class="s">&quot;</span>   { <span class="i">NULL</span> }
  | <span class="s">&#39;&quot;&#39;</span>      { <span class="i">read_string</span> <span class="s">&quot;</span><span class="s">&quot;</span> <span class="k">false</span> <span class="i">lexbuf</span> } 
  | <span class="s">&#39;{&#39;</span>      { <span class="i">LEFT_BRACE</span> }
  | <span class="s">&#39;}&#39;</span>      { <span class="i">RIGHT_BRACE</span> }
  | <span class="s">&#39;[&#39;</span>      { <span class="i">LEFT_BRACK</span> }
  | <span class="s">&#39;]&#39;</span>      { <span class="i">RIGHT_BRACK</span> }
  | <span class="s">&#39;:&#39;</span>      { <span class="i">COLON</span> }
  | <span class="s">&#39;,&#39;</span>      { <span class="i">COMMA</span> }
  | <span class="i">eof</span>      { <span class="i">EOF</span> }
  | _ { <span onmouseout="hideTip(event, 'fs22', 50)" onmouseover="showTip(event, 'fs22', 50)" class="i">raise</span> (<span class="i">Exception</span> (<span onmouseout="hideTip(event, 'fs23', 51)" onmouseover="showTip(event, 'fs23', 51)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">SyntaxError</span><span class="s">:</span><span class="s"> </span><span class="s">Unexpected</span><span class="s"> </span><span class="s">char</span><span class="s">:</span><span class="s"> </span><span class="s">&#39;</span><span class="s">%</span><span class="s">s&#39;</span><span class="s"> </span><span class="s">Line</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">d</span><span class="s"> </span><span class="s">Column</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">d</span><span class="s">&quot;</span> (<span class="i">lexeme</span> <span class="i">lexbuf</span>) (<span class="i">lexbuf</span><span class="o">.</span><span class="i">StartPos</span><span class="o">.</span><span class="i">Line</span><span class="o">+</span><span class="n">1</span>) <span class="i">lexbuf</span><span class="o">.</span><span class="i">StartPos</span><span class="o">.</span><span class="i">Column</span>)) }


<span class="k">and</span> <span class="i">read_string</span> <span class="i">str</span> <span class="i">ignorequote</span> <span class="o">=</span>
  <span class="i">parse</span>
  | <span class="s">&#39;&quot;&#39;</span>           { <span class="k">if</span> <span class="i">ignorequote</span>  <span class="k">then</span> (<span class="i">read_string</span> (<span class="i">str</span><span class="o">+</span><span class="s">&quot;</span><span class="s">\\</span><span class="s">\&quot;</span><span class="s">&quot;</span>) <span class="k">false</span> <span class="i">lexbuf</span>) <span class="k">else</span> <span class="i">STRING</span> (<span class="i">str</span>) }
  | <span class="s">&#39;\\&#39;</span>          { <span class="i">read_string</span> <span class="i">str</span> <span class="k">true</span> <span class="i">lexbuf</span> }
  | [<span class="o">^</span> <span class="s">&#39;&quot;&#39;</span> <span class="s">&#39;\\&#39;</span>]<span class="o">+</span> { <span class="i">read_string</span> (<span class="i">str</span><span class="o">+</span>(<span class="i">lexeme</span> <span class="i">lexbuf</span>)) <span class="k">false</span> <span class="i">lexbuf</span> }
  | <span class="i">eof</span>           { <span onmouseout="hideTip(event, 'fs22', 52)" onmouseover="showTip(event, 'fs22', 52)" class="i">raise</span> (<span class="i">Exception</span> (<span class="s">&quot;</span><span class="s">String</span><span class="s"> </span><span class="s">is</span><span class="s"> </span><span class="s">not</span><span class="s"> </span><span class="s">terminated</span><span class="s">&quot;</span>)) }</pre>
</td>
</tr>
</table>

<p>In project directory there will be a new file <code>Lexer.fs</code>. Include it in the project (it must be below <code>Parser.fs</code>).</p>

<p>The first part of a lexer is simply F# code enclosed in <code>{}</code>. It defines module, opens namespaces and defines helper functions. <code>lexeme</code> function will extract matched string from buffer. <code>newline</code> function updates buffer position to skip new lines characters. Notice that we open <em>Parser</em> module which contains the union type with tokens. We will use them in our productions.</p>

<p>Next we have a list of named regular expressions which we can use later. We can also use one regular expression within another by simply referring it by name. See line 22. <code>float</code> expression is referencing <code>digit, frac and exp</code> expressions. Space in expression means concatenation or  "and then" if you will. So for example <code>frac</code> expression at line 20 means: dot character then any number of digits. Characters in single quote are matched literally, for example '-' or '.'. If there are multiple expressions enclosed in <code>[]</code> at least one of them must be matched. You can also use ranges: <code>['0'-'9'] ['a'-'z'] ['A'-'Z']</code>.
Meaning of repetition patterns:</p>

<ul>
<li>? - 0 or 1</li>
<li>+ - 1 or more</li>
<li>* - 0 or more</li>
</ul>

<p>After the list of regular expressions patterns we have lexing rules. Each rule contains list of patterns with productions. Same as in parser one rule can reference another.  You can also pass arguments between rules.</p>

<p>If you look at productions left side, it  is a pattern and right side is a F# code which will be executed when pattern is matched. F# code also must return a value (same type of value across all productions withing rule). In our case we're returning tokens, which will be later used by parser.</p>

<p><code>read_string</code> rule takes two arguments <code>str</code>which is accumulator, and flag <code>ignorequote</code> which will make rule ignore next quote. This way we can process strings which contain escaped quote like: "abc\"df".</p>

<p>You should be able to build project and preview generated lexer in <code>Lexer.fs</code> file.</p>

<h2>5 Program</h2>

<p>The last piece of the puzzle is to write program which will user parser. Look at below code. <code>parse</code>function will take text json (string) parse it and return syntax tree. You can see result in debug:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">module</span> <span class="i">Program</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs18', 53)" onmouseover="showTip(event, 'fs18', 53)" class="i">Microsoft</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 54)" onmouseover="showTip(event, 'fs19', 54)" class="i">FSharp</span><span class="o">.</span><span class="i">Text</span><span class="o">.</span><span class="i">Lexing</span>
<span class="k">open</span> <span class="i">JsonParsing</span>

[&lt;<span onmouseout="hideTip(event, 'fs24', 55)" onmouseover="showTip(event, 'fs24', 55)" class="i">EntryPoint</span>&gt;]
<span class="k">let</span> <span class="i">main</span> <span class="i">argv</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">parse</span> <span class="i">json</span> <span class="o">=</span> 
        <span class="k">let</span> <span class="i">lexbuf</span> <span class="o">=</span> <span class="i">LexBuffer</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs25', 56)" onmouseover="showTip(event, 'fs25', 56)" class="i">char</span><span class="o">&lt;.</span><span class="i">FromString</span> <span class="i">json</span>
        <span class="k">let</span> <span class="i">res</span> <span class="o">=</span> <span class="i">Parser</span><span class="o">.</span><span class="i">start</span> <span class="i">Lexer</span><span class="o">.</span><span class="i">read</span> <span class="i">lexbuf</span>
        <span class="i">res</span>
    <span class="k">let</span> <span class="i">simpleJson</span> <span class="o">=</span> <span class="s">@&quot;</span><span class="s">{</span>
<span class="s">              </span><span class="s">&quot;&quot;</span><span class="s">title</span><span class="s">&quot;&quot;</span><span class="s">:</span><span class="s"> </span><span class="s">&quot;&quot;</span><span class="s">Cities</span><span class="s">&quot;&quot;</span><span class="s">,</span>
<span class="s">              </span><span class="s">&quot;&quot;</span><span class="s">cities</span><span class="s">&quot;&quot;</span><span class="s">:</span><span class="s"> </span><span class="s">[</span>
<span class="s">                </span><span class="s">{</span><span class="s"> </span><span class="s">&quot;&quot;</span><span class="s">name</span><span class="s">&quot;&quot;</span><span class="s">:</span><span class="s"> </span><span class="s">&quot;&quot;</span><span class="s">Chicago</span><span class="s">&quot;&quot;</span><span class="s">,</span><span class="s">  </span><span class="s">&quot;&quot;</span><span class="s">zips</span><span class="s">&quot;&quot;</span><span class="s">:</span><span class="s"> </span><span class="s">[</span><span class="s">60601</span><span class="s">,</span><span class="s">60600</span><span class="s">]</span><span class="s"> </span><span class="s">}</span><span class="s">,</span>
<span class="s">                </span><span class="s">{</span><span class="s"> </span><span class="s">&quot;&quot;</span><span class="s">name</span><span class="s">&quot;&quot;</span><span class="s">:</span><span class="s"> </span><span class="s">&quot;&quot;</span><span class="s">New</span><span class="s"> </span><span class="s">York</span><span class="s">&quot;&quot;</span><span class="s">,</span><span class="s"> </span><span class="s">&quot;&quot;</span><span class="s">zips</span><span class="s">&quot;&quot;</span><span class="s">:</span><span class="s"> </span><span class="s">[</span><span class="s">10001</span><span class="s">]</span><span class="s"> </span><span class="s">}</span><span class="s"> </span>
<span class="s">              </span><span class="s">]</span>
<span class="s">            </span><span class="s">}</span><span class="s">&quot;</span>
    <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs16', 57)" onmouseover="showTip(event, 'fs16', 57)" class="i">Some</span> <span class="i">parseResult</span>) <span class="o">=</span> <span class="i">simpleJson</span> <span class="o">|&gt;</span> <span class="i">parse</span>

<span class="n">0</span></pre>
</td>
</tr>
</table>

<p>You can also add <code>print</code> function to JsonValue and show result of parsing in console:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs1', 58)" onmouseover="showTip(event, 'fs1', 58)" class="i">JsonValue</span> <span class="o">=</span> 
  | <span onmouseout="hideTip(event, 'fs2', 59)" onmouseover="showTip(event, 'fs2', 59)" class="i">Assoc</span> <span class="k">of</span> (<span onmouseout="hideTip(event, 'fs3', 60)" onmouseover="showTip(event, 'fs3', 60)" class="i">string</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs1', 61)" onmouseover="showTip(event, 'fs1', 61)" class="i">JsonValue</span>) <span onmouseout="hideTip(event, 'fs4', 62)" onmouseover="showTip(event, 'fs4', 62)" class="i">list</span>
  | <span onmouseout="hideTip(event, 'fs5', 63)" onmouseover="showTip(event, 'fs5', 63)" class="i">Bool</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs6', 64)" onmouseover="showTip(event, 'fs6', 64)" class="i">bool</span>
  | <span onmouseout="hideTip(event, 'fs7', 65)" onmouseover="showTip(event, 'fs7', 65)" class="i">Float</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs8', 66)" onmouseover="showTip(event, 'fs8', 66)" class="i">float</span>
  | <span onmouseout="hideTip(event, 'fs9', 67)" onmouseover="showTip(event, 'fs9', 67)" class="i">Int</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs10', 68)" onmouseover="showTip(event, 'fs10', 68)" class="i">int</span>
  | <span onmouseout="hideTip(event, 'fs11', 69)" onmouseover="showTip(event, 'fs11', 69)" class="i">List</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 70)" onmouseover="showTip(event, 'fs1', 70)" class="i">JsonValue</span> <span onmouseout="hideTip(event, 'fs4', 71)" onmouseover="showTip(event, 'fs4', 71)" class="i">list</span>
  | <span onmouseout="hideTip(event, 'fs12', 72)" onmouseover="showTip(event, 'fs12', 72)" class="i">Null</span>
  | <span onmouseout="hideTip(event, 'fs13', 73)" onmouseover="showTip(event, 'fs13', 73)" class="i">String</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 74)" onmouseover="showTip(event, 'fs3', 74)" class="i">string</span>
<span class="c">//below function is not important, it simply prints values </span>
<span class="k">static</span> <span class="k">member</span> <span class="i">print</span> <span class="i">x</span> <span class="o">=</span> 
          <span class="k">match</span> <span class="i">x</span> <span class="k">with</span>
          | <span onmouseout="hideTip(event, 'fs5', 75)" onmouseover="showTip(event, 'fs5', 75)" class="i">Bool</span> <span class="i">b</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs23', 76)" onmouseover="showTip(event, 'fs23', 76)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">Bool</span><span class="s">(</span><span class="s">%</span><span class="s">b</span><span class="s">)</span><span class="s">&quot;</span> <span class="i">b</span>
          | <span onmouseout="hideTip(event, 'fs7', 77)" onmouseover="showTip(event, 'fs7', 77)" class="i">Float</span> <span class="i">f</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs23', 78)" onmouseover="showTip(event, 'fs23', 78)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">Float</span><span class="s">(</span><span class="s">%</span><span class="s">f</span><span class="s">)</span><span class="s">&quot;</span> <span class="i">f</span>
          | <span onmouseout="hideTip(event, 'fs9', 79)" onmouseover="showTip(event, 'fs9', 79)" class="i">Int</span> <span class="i">d</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs23', 80)" onmouseover="showTip(event, 'fs23', 80)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">Int</span><span class="s">(</span><span class="s">%</span><span class="s">d</span><span class="s">)</span><span class="s">&quot;</span> <span class="i">d</span>
          | <span onmouseout="hideTip(event, 'fs13', 81)" onmouseover="showTip(event, 'fs13', 81)" class="i">String</span> <span class="i">s</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs23', 82)" onmouseover="showTip(event, 'fs23', 82)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">String</span><span class="s">(</span><span class="s">%</span><span class="s">s</span><span class="s">)</span><span class="s">&quot;</span> <span class="i">s</span>
          | <span onmouseout="hideTip(event, 'fs12', 83)" onmouseover="showTip(event, 'fs12', 83)" class="i">Null</span> <span class="k">-&gt;</span>  <span class="s">&quot;</span><span class="s">Null</span><span class="s">(</span><span class="s">)</span><span class="s">&quot;</span>
          | <span onmouseout="hideTip(event, 'fs2', 84)" onmouseover="showTip(event, 'fs2', 84)" class="i">Assoc</span> <span class="i">props</span> <span class="k">-&gt;</span>  <span class="i">props</span> 
                             <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs11', 85)" onmouseover="showTip(event, 'fs11', 85)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 86)" onmouseover="showTip(event, 'fs26', 86)" class="i">map</span> (<span class="k">fun</span> (<span class="i">name</span>,<span class="i">value</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs23', 87)" onmouseover="showTip(event, 'fs23', 87)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">\&quot;</span><span class="s">%</span><span class="s">s</span><span class="s">\&quot;</span><span class="s"> </span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span class="i">name</span> (<span onmouseout="hideTip(event, 'fs1', 88)" onmouseover="showTip(event, 'fs1', 88)" class="i">JsonValue</span><span class="o">.</span><span class="i">print</span>(<span class="i">value</span>))) 
                             <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs13', 89)" onmouseover="showTip(event, 'fs13', 89)" class="i">String</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 90)" onmouseover="showTip(event, 'fs27', 90)" class="i">concat</span> <span class="s">&quot;</span><span class="s">,</span><span class="s">&quot;</span>
                             <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 91)" onmouseover="showTip(event, 'fs23', 91)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">Assoc</span><span class="s">(</span><span class="s">%</span><span class="s">s</span><span class="s">)</span><span class="s">&quot;</span>
          | <span onmouseout="hideTip(event, 'fs11', 92)" onmouseover="showTip(event, 'fs11', 92)" class="i">List</span> <span class="i">values</span> <span class="k">-&gt;</span>  <span class="i">values</span>
                             <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs11', 93)" onmouseover="showTip(event, 'fs11', 93)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 94)" onmouseover="showTip(event, 'fs26', 94)" class="i">map</span> (<span class="k">fun</span> <span class="i">value</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs1', 95)" onmouseover="showTip(event, 'fs1', 95)" class="i">JsonValue</span><span class="o">.</span><span class="i">print</span>(<span class="i">value</span>)) 
                             <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs13', 96)" onmouseover="showTip(event, 'fs13', 96)" class="i">String</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 97)" onmouseover="showTip(event, 'fs27', 97)" class="i">concat</span> <span class="s">&quot;</span><span class="s">,</span><span class="s">&quot;</span>
                             <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 98)" onmouseover="showTip(event, 'fs23', 98)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">List</span><span class="s">(</span><span class="s">%</span><span class="s">s</span><span class="s">)</span><span class="s">&quot;</span>
                             <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 99)" onmouseover="showTip(event, 'fs23', 99)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">List</span><span class="s">(</span><span class="s">%</span><span class="s">s</span><span class="s">)</span><span class="s">&quot;</span></pre>
</td>
</tr>
</table>

<p>And then change program to print result of parsing in console, add this line after line 18:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs28', 100)" onmouseover="showTip(event, 'fs28', 100)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> (<span onmouseout="hideTip(event, 'fs1', 101)" onmouseover="showTip(event, 'fs1', 101)" class="i">JsonValue</span><span class="o">.</span><span class="i">print</span> <span class="i">parseResult</span>)</pre>
</td>
</tr>
</table>

<div class="tip" id="fs1">type JsonValue =<br />&#160;&#160;| Assoc of (string * JsonValue) list<br />&#160;&#160;| Bool of bool<br />&#160;&#160;| Float of float<br />&#160;&#160;| Int of int<br />&#160;&#160;| List of JsonValue list<br />&#160;&#160;| Null<br />&#160;&#160;| String of string<br /><br />Full name: jsonParserExample.JsonValue</div>
<div class="tip" id="fs2">union case JsonValue.Assoc: (string * JsonValue) list -&gt; JsonValue</div>
<div class="tip" id="fs3">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs4">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs5">union case JsonValue.Bool: bool -&gt; JsonValue</div>
<div class="tip" id="fs6">type bool = System.Boolean<br /><br />Full name: Microsoft.FSharp.Core.bool</div>
<div class="tip" id="fs7">union case JsonValue.Float: float -&gt; JsonValue</div>
<div class="tip" id="fs8">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = System.Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs9">union case JsonValue.Int: int -&gt; JsonValue</div>
<div class="tip" id="fs10">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs11">Multiple items<br />union case JsonValue.List: JsonValue list -&gt; JsonValue<br /><br />--------------------<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs12">union case JsonValue.Null: JsonValue</div>
<div class="tip" id="fs13">Multiple items<br />union case JsonValue.String: string -&gt; JsonValue<br /><br />--------------------<br />module String<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs14">type &#39;T option = Option&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.option&lt;_&gt;</div>
<div class="tip" id="fs15">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs16">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs17">val rev : list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.rev</div>
<div class="tip" id="fs18">namespace Microsoft</div>
<div class="tip" id="fs19">namespace Microsoft.FSharp</div>
<div class="tip" id="fs20">namespace System</div>
<div class="tip" id="fs21">val exp : value:&#39;T -&gt; &#39;T (requires member Exp)<br /><br />Full name: Microsoft.FSharp.Core.Operators.exp</div>
<div class="tip" id="fs22">val raise : exn:System.Exception -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.raise</div>
<div class="tip" id="fs23">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs24">Multiple items<br />type EntryPointAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; EntryPointAttribute<br /><br />Full name: Microsoft.FSharp.Core.EntryPointAttribute<br /><br />--------------------<br />new : unit -&gt; EntryPointAttribute</div>
<div class="tip" id="fs25">Multiple items<br />val char : value:&#39;T -&gt; char (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.char<br /><br />--------------------<br />type char = System.Char<br /><br />Full name: Microsoft.FSharp.Core.char</div>
<div class="tip" id="fs26">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs27">val concat : sep:string -&gt; strings:seq&lt;string&gt; -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.String.concat</div>
<div class="tip" id="fs28">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>

        </div>
        <div class="span3">
          <img src="/FsLexYacc/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />
          <a href="https://travis-ci.org/fsprojects/FsLexYacc" style="margin-left: 20px;padding-right: 150px;">
            <img src="https://travis-ci.org/fsprojects/FsLexYacc.svg" alt="travis-ci" />
          </a>
          <a href="https://ci.appveyor.com/project/fsgit/fslexyacc" style="margin-left: 20px;">
            <img src="https://ci.appveyor.com/api/projects/status/061nqkynrysnyiv7" alt="appveyor-ci" />
          </a>
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">FsLexYacc</li>
            <li><a href="/FsLexYacc/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="https://www.nuget.org/packages/FsLexYacc/">Get Library via NuGet</a></li>
            <li><a href="http://github.com/fsprojects/FsLexYacc">Source Code on GitHub</a></li>
            <li><a href="http://github.com/fsprojects/FsLexYacc/blob/master/LICENSE.txt">License</a></li>
            <li><a href="http://github.com/fsprojects/FsLexYacc/blob/master/RELEASE_NOTES.md">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/FsLexYacc/fslex.html">Using FsLex</a></li>
            <li><a href="/FsLexYacc/fsyacc.html">Using FsYacc</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/FsLexYacc/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsprojects/FsLexYacc"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>
